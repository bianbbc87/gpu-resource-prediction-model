# PerfSeer 시작 가이드

이 가이드는 PerfSeer를 처음부터 설정하고 실행하여 논문 결과를 재현하는 방법을 안내합니다.

## 사전 요구사항

- Python 3.8+ 
- macOS/Linux 시스템
- 최소 8GB RAM
- 10GB 여유 디스크 공간

## 1단계: 환경 설정

### 1.1 프로젝트 폴더로 이동
```bash
cd /path/to/your/project/PerfSeer
```

### 1.2 가상환경 생성
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 1.3 pip 업그레이드
```bash
python -m pip install --upgrade pip
```

## 2단계: 의존성 설치

### 2.1 기본 패키지 설치
```bash
pip install -r requirements.txt
```

### 2.2 PyTorch 설치
```bash
pip install torch torchvision
```

### 2.3 설치 확인
```bash
python -c "import torch; print('PyTorch 버전:', torch.__version__)"
python -c "import networkx; print('NetworkX 설치 완료')"
```

## 3단계: 데이터 준비

### 3.1 데이터 구조 확인
데이터 디렉토리 구조가 다음과 같은지 확인하세요:
```
PerfSeer/
├── data/
│   ├── graphs/          # 53k+ .pkl 파일들
│   └── labels/          # 53k+ .txt 파일들
├── configs/
├── model/
└── train/
```

### 3.2 데이터 파일 확인
```bash
ls data/graphs | head -5    # .pkl 파일들이 보여야 함
ls data/labels | head -5    # .txt 파일들이 보여야 함
echo "그래프 파일 수: $(ls data/graphs | wc -l)"
echo "라벨 파일 수: $(ls data/labels | wc -l)"
```

## 4단계: 설정 파일 준비

### 4.1 테스트용 설정 파일 생성
`configs/quick_test.yaml` 파일을 생성하세요:
```yaml
model:
  node_dim: 30
  edge_dim: 5
  global_dim: 18
  hidden_dim: 256
  global_node_dim: 256

train:
  epochs: 5
  lr: 0.00001
  loss: mse
  batch_size: 16

dataset:
  graph_dir: data/graphs
  label_dir: data/labels
  max_samples: 1000  # 테스트용으로 작게 시작

device:
  device: cpu  # GPU 있으면 'cuda'로 변경
```

### 4.2 전체 학습용 설정 파일 생성
`configs/full_training.yaml` 파일을 생성하세요:
```yaml
model:
  node_dim: 30
  edge_dim: 5
  global_dim: 18
  hidden_dim: 256
  global_node_dim: 256

train:
  epochs: 50
  lr: 0.00001
  loss: mse
  batch_size: 32

dataset:
  graph_dir: data/graphs
  label_dir: data/labels
  # max_samples: null  # 전체 데이터 사용

device:
  device: cuda  # 전체 학습시 GPU 사용
```

## 5단계: 빠른 테스트 실행

### 5.1 작은 데이터셋으로 테스트
```bash
source venv/bin/activate
CONFIG_PATH=configs/quick_test.yaml OUTPUT_DIR=outputs/quick_test bash scripts/train.sh
```

**예상 출력:**
```
====================================
학습 시작
====================================
INFO:PerfSeer:자동 감지된 차원: node_dim=30, edge_dim=5, global_dim=18
INFO:PerfSeer:--- Epoch 001 ---
INFO:PerfSeer:Batch 100/1000, Loss: [감소하는 값들]
INFO:PerfSeer:[Epoch 001] Loss=X.XXXXXX | MAPE=XX.XXXX | RMSPE=XX.XXXX
...
INFO:PerfSeer:===== 학습 완료 =====
```

### 5.2 테스트 결과 확인
```bash
ls outputs/quick_test/
# 다음이 보여야 함: model.pt, metrics.json
```

## 6단계: 성능 평가

### 6.1 종합 성능 평가 실행
```bash
source venv/bin/activate
python evaluate_performance.py
```

### 6.2 결과 확인
```bash
cat outputs/test/comprehensive_evaluation.md
```

**성공 지표:**
- MAPE < 50% (보통 성능)
- MAPE < 25% (좋은 성능) 
- MAPE < 10% (우수한 성능)
- 예측값에 `inf` 값이 없어야 함

## 7단계: 전체 학습 (선택사항)

### 7.1 전체 데이터셋으로 학습
```bash
source venv/bin/activate
CONFIG_PATH=configs/full_training.yaml OUTPUT_DIR=outputs/full_training bash scripts/train.sh
```

**참고:** 하드웨어에 따라 몇 시간이 걸릴 수 있습니다.

### 7.2 학습 진행 상황 모니터링
```bash
tail -f outputs/full_training/training.log  # 로깅이 활성화된 경우
```

## 8단계: 결과 분석

### 8.1 성능 리포트 생성
```bash
# evaluate_performance.py에서 전체 학습 모델 사용하도록 수정
sed -i 's/outputs\/test\/model.pt/outputs\/full_training\/model.pt/g' evaluate_performance.py
python evaluate_performance.py
```

### 8.2 논문 결과와 비교
`outputs/full_training/comprehensive_evaluation.md`에 생성된 리포트에서 다음을 확인:
- README 표와 일치하는 데이터셋 통계
- 모델 성능 지표
- 개선 권장사항

## 문제 해결

### 일반적인 문제들

#### 1. Import 오류
```bash
# "ModuleNotFoundError" 발생시
pip install -r requirements.txt
pip install torch torchvision
```

#### 2. CUDA 문제
```bash
# CUDA를 사용할 수 없는 경우, CPU 사용
# 설정 파일에서 device: cuda를 device: cpu로 변경
```

#### 3. 메모리 부족
```bash
# 설정에서 배치 크기나 max_samples 줄이기
# 예: batch_size: 8, max_samples: 500
```

#### 4. 무한대 Loss 값
```bash
# 설정에서 학습률 줄이기
# 예: lr: 0.000001
```

#### 5. 데이터 로딩 오류
```bash
# 데이터 경로 확인
ls data/graphs | head -5
ls data/labels | head -5
```

### 성능 기대치

| 데이터셋 크기 | 예상 MAPE | 학습 시간 | 하드웨어 |
|--------------|-----------|----------|----------|
| 1,000 샘플 | 30-50% | 5-10분 | CPU |
| 10,000 샘플 | 20-35% | 30-60분 | CPU |
| 53,000+ 샘플 | 10-25% | 2-6시간 | GPU |

## 성공 기준

✅ **설정 완료** 조건:
- 가상환경 활성화됨
- 모든 의존성 설치됨
- 테스트 학습이 오류 없이 완료됨
- 성능 평가 리포트가 생성됨

✅ **모델 작동** 조건:
- 테스트 데이터셋에서 MAPE < 50%
- 예측값에 `inf`나 `nan` 값이 없음
- 에포크마다 Loss가 감소함

✅ **논문 재현** 조건:
- 전체 데이터셋에서 MAPE < 25%
- 성능 지표가 논문 범위와 일치
- 모델이 새로운 데이터에 일반화됨

## 다음 단계

1. **하이퍼파라미터 튜닝**: 학습률, 배치 크기, 에포크 수 조정
2. **아키텍처 실험**: 모델 차원 수정
3. **데이터 분석**: 데이터셋 특성 탐색
4. **성능 최적화**: GPU 사용, 더 큰 배치 크기
5. **프로덕션 배포**: 추론용 모델 내보내기

## 지원

문제가 발생하면:
1. 위의 문제 해결 섹션을 확인하세요
2. 환경이 사전 요구사항과 일치하는지 확인하세요
3. 전체 학습 전에 작은 데이터셋(1000 샘플)으로 시작하세요
4. Loss 값을 모니터링하세요 - 에포크마다 감소해야 합니다

## 설정 후 파일 구조

```
PerfSeer/
├── venv/                    # 가상환경
├── data/
│   ├── graphs/             # 입력 그래프 데이터
│   └── labels/             # 성능 라벨
├── configs/
│   ├── quick_test.yaml     # 테스트 설정
│   └── full_training.yaml  # 프로덕션 설정
├── outputs/
│   ├── quick_test/         # 테스트 결과
│   └── full_training/      # 전체 학습 결과
├── model/                  # 모델 아키텍처
├── train/                  # 학습 유틸리티
├── evaluate_performance.py # 평가 스크립트
└── requirements.txt        # 의존성
```

이것으로 설정 과정이 완료됩니다. 이제 PerfSeer 논문 결과를 재현할 수 있습니다!
